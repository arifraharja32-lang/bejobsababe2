<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BaBe Aja - Lokasi & Rekomendasi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; overflow-x: hidden; }
        .bg-bukalapak { background-color: #E31E52; }
        .text-bukalapak { color: #E31E52; }
        .btn-primary { background-color: #E31E52; color: white; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold; width: 100%; display: block; }
        
        .image-slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .image-slider::-webkit-scrollbar { display: none; }
        .image-slider .slide-item {
            flex: 0 0 100%;
            scroll-snap-align: start;
            position: relative;
        }
        
        #product-detail-modal {
            transition: transform 0.3s ease-out;
            transform: translateY(100%);
        }
        #product-detail-modal.active {
            transform: translateY(0);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .dot {
            width: 6px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transition: all 0.3s ease;
            margin: 0 3px;
        }
        .dot.active {
            background-color: white;
            transform: scale(1.3);
            width: 14px;
            border-radius: 10px;
        }
    </style>
</head>
<body class="max-w-md mx-auto bg-white min-h-screen pb-24 shadow-xl relative">

    <!-- Header -->
    <header class="bg-bukalapak text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-2">
            <span class="text-2xl">üì¶</span>
            <h1 class="text-xl font-black tracking-tight uppercase">BaBe Aja</h1>
        </div>
        <button onclick="showPage('upload')" class="bg-white text-bukalapak px-4 py-1.5 rounded-lg text-xs font-black uppercase shadow-sm">
            + Jual
        </button>
    </header>

    <!-- Status Lokasi User -->
    <div class="bg-indigo-50 text-[10px] text-indigo-700 px-4 py-2 flex items-center justify-between border-b border-indigo-100 font-bold">
        <span>üìç Lokasi Anda: <span id="user-city">Bandung Kota</span></span>
        <span class="text-indigo-400">Otomatis</span>
    </div>

    <!-- Home Page -->
    <main id="page-home" class="p-4">
        <div class="mb-5">
            <input type="text" id="search-input" oninput="renderProducts()" placeholder="Cari di sekitar Bandung..." class="w-full px-4 py-3 border border-gray-200 rounded-xl bg-gray-50 outline-none text-sm mb-4 focus:ring-2 focus:ring-red-200 transition-all">
            
            <h2 class="text-[11px] font-black text-gray-400 uppercase tracking-widest mb-3">Iklan Terbaru</h2>
            <div id="product-list" class="grid grid-cols-2 gap-3">
                <!-- Produk Utama -->
            </div>
        </div>
    </main>

    <!-- Modal Detail Produk -->
    <div id="product-detail-modal" class="fixed inset-0 bg-white z-[60] hidden flex-col overflow-y-auto no-scrollbar">
        <div class="sticky top-0 bg-white/90 backdrop-blur-md z-10 p-4 flex items-center border-b">
            <button onclick="closeDetail()" class="p-2 bg-gray-100 rounded-full mr-3 text-lg">‚úï</button>
            <div class="overflow-hidden">
                <h2 class="font-black text-[10px] truncate uppercase text-gray-500" id="detail-header-loc">Lokasi</h2>
                <h2 class="font-bold text-xs truncate uppercase text-gray-800" id="detail-header-title">Nama Barang</h2>
            </div>
        </div>

        <div class="flex-1">
            <div class="relative">
                <div class="image-slider h-96 bg-gray-900" id="detail-slider" onscroll="updateDots(this)">
                    <!-- Foto diisi JS -->
                </div>
                <div id="dot-container" class="absolute bottom-6 left-0 right-0 flex justify-center items-center pointer-events-none">
                    <!-- Titik-titik diisi JS -->
                </div>
            </div>
            
            <div class="p-6">
                <div class="mb-6">
                    <p id="detail-full-location" class="text-[10px] text-red-500 font-black uppercase tracking-tighter mb-1"></p>
                    <h2 id="detail-title" class="text-2xl font-black text-gray-800 leading-tight uppercase mb-2"></h2>
                    <div class="flex items-center space-x-2 text-gray-500 text-xs">
                        <span class="bg-gray-100 px-2 py-1 rounded">Kondisi Bekas</span>
                        <span class="bg-gray-100 px-2 py-1 rounded">Nego Halus</span>
                    </div>
                </div>

                <a id="detail-wa-btn" href="#" target="_blank" class="w-full bg-[#25D366] text-white py-4 rounded-xl font-black text-center block mb-8 shadow-xl hover:brightness-95 transition-all active:scale-95 uppercase tracking-widest">
                    Chat via WhatsApp
                </a>

                <div class="border-t pt-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-black text-gray-800 text-xs uppercase tracking-widest">Iklan Serupa di Sekitar Anda</h3>
                    </div>
                    <div id="recommendation-list" class="flex space-x-3 overflow-x-auto pb-6 no-scrollbar">
                        <!-- Produk Rekomendasi -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Halaman Upload -->
    <section id="page-upload" class="hidden p-6">
        <div class="flex items-center mb-8">
            <button onclick="showPage('home')" class="mr-4 text-gray-800 p-2 bg-gray-100 rounded-full">‚Üê</button>
            <h2 class="text-xl font-black uppercase italic tracking-tighter">Pasang Iklan</h2>
        </div>
        <div class="space-y-5">
            <div>
                <label class="text-[10px] font-bold uppercase text-gray-400 mb-1 block">Detail Barang</label>
                <input type="text" id="title" placeholder="Contoh: Honda Beat 2019 - 10jt" class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-red-200 outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold uppercase text-gray-400 mb-1 block">Kontak WhatsApp</label>
                <input type="number" id="wa-number" placeholder="628xxxxxxxxxx" class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-red-200 outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold uppercase text-gray-400 mb-1 block">Pilih Lokasi (Simulasi)</label>
                <select id="upload-location" class="w-full p-4 border border-gray-200 rounded-xl bg-white outline-none">
                    <option value="Kec. Cicendo, Bandung Kota">Cicendo, Bandung Kota</option>
                    <option value="Kec. Coblong, Bandung Kota">Coblong, Bandung Kota</option>
                    <option value="Kec. Tambaksari, Surabaya">Tambaksari, Surabaya</option>
                </select>
            </div>
            <button onclick="submitProduct()" class="btn-primary shadow-lg shadow-red-200 uppercase tracking-widest py-5">TAYANGKAN SEKARANG</button>
        </div>
    </section>

    <!-- Navigasi Bawah -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center h-20 max-w-md mx-auto z-40 px-4">
        <button onclick="showPage('home')" class="flex flex-col items-center flex-1 py-2 text-bukalapak">
            <span class="text-[10px] font-black uppercase tracking-tighter">Beranda</span>
        </button>
        <div class="w-px h-8 bg-gray-100"></div>
        <button onclick="showPage('upload')" class="flex flex-col items-center flex-1 py-2 text-gray-400">
            <span class="text-[10px] font-black uppercase tracking-tighter">Jual Barang</span>
        </button>
    </nav>

    <script>
        // Data Dummy dengan Struktur Lokasi: Kecamatan, Kabupaten/Kota
        const defaultProducts = [
            { id: 1, category: 'motor', title: "Honda Vario 150 2021 - 14jt", wa: "6281234567801", district: "Coblong", city: "Bandung Kota", images: ["https://images.unsplash.com/photo-1558981806-ec527fa84c39?w=600", "https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=600", "https://images.unsplash.com/photo-1599819811279-d5ad9cccf838?w=600", "https://images.unsplash.com/photo-1444491741275-3747c53c99b4?w=600", "https://images.unsplash.com/photo-1591637333184-19aa84b3e01f?w=600", "https://images.unsplash.com/photo-1558981001-792f6c0d5068?w=600"] },
            { id: 2, category: 'gadget', title: "iPhone 13 Pro Max - 12jt", wa: "6281234567802", district: "Gambir", city: "Jakarta Pusat", images: ["https://images.unsplash.com/photo-1632661674596-df8be070a5c5?w=600", "https://images.unsplash.com/photo-1510557880182-3d4d3cba3f95?w=600", "https://images.unsplash.com/photo-1591337676887-a217a6970c8a?w=600"] },
            { id: 3, category: 'gadget', title: "Macbook Air M1 2020 - 9jt", wa: "6281234567803", district: "Tegalsari", city: "Surabaya", images: ["https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=600", "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=600"] },
            { id: 4, category: 'elektronik', title: "Sony A6400 Kit - 8.5jt", wa: "6281234567804", district: "Gajahmungkur", city: "Semarang", images: ["https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=600"] },
            { id: 5, category: 'motor', title: "Yamaha NMAX 2020 - 22jt", wa: "6281234567805", district: "Lengkong", city: "Bandung Kota", images: ["https://images.unsplash.com/photo-1591637333184-19aa84b3e01f?w=600", "https://images.unsplash.com/photo-1558981001-792f6c0d5068?w=600"] },
            { id: 8, category: 'motor', title: "Honda Scoopy 2022 - 17jt", wa: "6281234567808", district: "Astana Anyar", city: "Bandung Kota", images: ["https://images.unsplash.com/photo-1599819811279-d5ad9cccf838?w=600"] },
            { id: 12, category: 'motor', title: "Kawasaki Ninja 250 - 35jt", wa: "6281234567812", district: "Antapani", city: "Bandung Kota", images: ["https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=600"] }
        ];

        let products = JSON.parse(localStorage.getItem('babe_v7')) || defaultProducts;

        function renderProducts() {
            const list = document.getElementById('product-list');
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = products.filter(p => p.title.toLowerCase().includes(query));

            list.innerHTML = filtered.map(p => `
                <div onclick="openDetail(${p.id})" class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm flex flex-col h-full cursor-pointer active:scale-95 transition-transform duration-200">
                    <div class="h-32 bg-gray-100">
                        <img src="${p.images[0]}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3 flex-1 flex flex-col justify-between">
                        <div>
                            <p class="text-[8px] text-red-500 font-black uppercase mb-1">${p.district}</p>
                            <h3 class="font-bold text-[10px] text-gray-800 leading-tight uppercase line-clamp-2">${p.title}</h3>
                        </div>
                        <p class="text-[8px] text-gray-400 mt-2 font-bold italic">${p.city}</p>
                    </div>
                </div>
            `).join('');
        }

        function updateDots(slider) {
            const index = Math.round(slider.scrollLeft / slider.clientWidth);
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, i) => i === index ? dot.classList.add('active') : dot.classList.remove('active'));
        }

        function openDetail(id) {
            const product = products.find(p => p.id === id);
            if(!product) return;

            // Header & Info
            document.getElementById('detail-header-loc').innerText = product.city;
            document.getElementById('detail-header-title').innerText = product.title;
            document.getElementById('detail-title').innerText = product.title;
            document.getElementById('detail-full-location').innerText = `üìç Kec. ${product.district}, ${product.city}`;
            document.getElementById('detail-wa-btn').href = "https://wa.me/" + product.wa;

            // Slider
            const slider = document.getElementById('detail-slider');
            slider.innerHTML = product.images.slice(0, 6).map(img => `
                <div class="slide-item">
                    <img src="${img}" class="w-full h-full object-cover">
                </div>
            `).join('');

            // Dots
            const dotContainer = document.getElementById('dot-container');
            dotContainer.innerHTML = Array(Math.min(product.images.length, 6)).fill(0).map((_, i) => 
                `<div class="dot ${i === 0 ? 'active' : ''}"></div>`
            ).join('');

            slider.scrollLeft = 0;

            // Rekomendasi Terdekat (Kabupaten Sama + Kategori Sama)
            const recommendations = products.filter(p => 
                p.id !== product.id && 
                (p.category === product.category || p.city === product.city)
            ).sort((a, b) => {
                // Prioritaskan yang kotanya sama persis
                if (a.city === product.city && b.city !== product.city) return -1;
                return 0;
            }).slice(0, 6);

            const recList = document.getElementById('recommendation-list');
            recList.innerHTML = recommendations.map(p => `
                <div onclick="event.stopPropagation(); openDetail(${p.id})" class="min-w-[150px] bg-white border border-gray-100 rounded-xl overflow-hidden shadow-sm cursor-pointer active:scale-95 transition-all">
                    <img src="${p.images[0]}" class="w-full h-28 object-cover">
                    <div class="p-3">
                        <p class="text-[8px] font-black text-red-500 uppercase truncate">${p.district}</p>
                        <p class="text-[10px] font-bold text-gray-800 truncate uppercase mb-1">${p.title}</p>
                        <p class="text-[7px] text-gray-400 font-bold italic">${p.city}</p>
                    </div>
                </div>
            `).join('');

            const modal = document.getElementById('product-detail-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('active'), 10);
            document.body.style.overflow = 'hidden';
            modal.scrollTo(0,0);
        }

        function closeDetail() {
            const modal = document.getElementById('product-detail-modal');
            modal.classList.remove('active');
            setTimeout(() => modal.classList.add('hidden'), 300);
            document.body.style.overflow = 'auto';
        }

        function showPage(page) {
            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-upload').classList.add('hidden');
            document.getElementById('page-' + page).classList.remove('hidden');
            closeDetail();
        }

        function submitProduct() {
            const title = document.getElementById('title').value;
            const wa = document.getElementById('wa-number').value;
            const locVal = document.getElementById('upload-location').value; // Format: "Kec. X, Kota Y"
            
            if(!title || !wa) return alert("Harap isi semua data!");

            const locParts = locVal.split(', ');
            
            const newProd = {
                id: Date.now(),
                category: title.toLowerCase().includes('motor') ? 'motor' : 'umum',
                title: title,
                wa: wa,
                district: locParts[0].replace('Kec. ', ''),
                city: locParts[1],
                images: ["https://images.unsplash.com/photo-1534073828943-f801091bb18c?w=600"]
            };

            products.unshift(newProd);
            localStorage.setItem('babe_v7', JSON.stringify(products));
            showPage('home');
            renderProducts();
        }

        window.onload = renderProducts;
    </script>
</body>
</html>
